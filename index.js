// encoding-lang-sa.js

var MT = require('multichar-transcription')

module.exports = (function(options) {
  var funcs = {}
    , encs = {
        'deva': {
          'a': '\u0900',
          'ā': '\u093E',
          'i': '\u093F',
          'ī': '\u0940',
          'u': '\u0941',
          'ū': '\u0942',
          'ṛ': '\u0943',
          'ṝ': '\u0944',
          'ḷ': '\u0962',
          'ḹ': '\u0963',
          'e': '\u0947',
          'ai': '\u0948',
          'o': '\u094B',
          'au': '\u094C',
          'ṃ':  '\u0902',
          'ḥ': '\u0903',
          'k': 'क्',
          'kh': 'ख्',
          'g': 'ग्',
          'gh': 'घ्',
          'ṅ': 'ङ्',
          'c': 'च्',
          'ch': 'छ्',
          'j': 'ज्',
          'jh': 'झ्',
          'ñ': 'ञ्',
          'ṭ': 'ट्',
          'ṭh': 'ठ्',
          'ḍ': 'ड्',
          'ḍh': 'ढ्',
          'ṇ': 'ण्',
          't': 'त्',
          'th': 'थ्',
          'd': 'द्',
          'dh': 'ध्',
          'n': 'न्',
          'p': 'प्',
          'ph': 'फ्',
          'b': 'ब्',
          'bh': 'भ्',
          'm': 'म्',
          'y': 'य्',
          'r': 'र्',
          'l': 'ल्',
          'v': 'व्',
          'ś': 'श्',
          'ṣ': 'ष्',
          's': 'स्',
          'h': 'ह्',
          '^a': 'अ',
          '^ā': 'आ',
          '^i': 'इ',
          '^ī': 'ई',
          '^u': 'उ',
          '^ū': 'ऊ',
          '^ṛ': 'ऋ',
          '^ṝ': 'ॠ',
          '^ḷ': 'ऌ',
          '^ḹ': 'ॡ',
          '^e': 'ए',
          '^ai': 'ऐ',
          '^o': 'ओ',
          '^au': 'औ',
          '_': '\u094D',
          "'": 'ऽ',
          "''": "'",
          '/': ' ।',
          '//': ' ॥'
        }
      , 'iast': {
          'a': 'a',
          'ā': 'ā',
          'i': 'i',
          'ī': 'ī',
          'u': 'u',
          'ū': 'ū',
          'ṛ': 'ṛ',
          'ṝ': 'ṝ',
          'ḷ': 'ḷ',
          'ḹ': 'ḹ',
          'e': 'e',
          'ai': 'ai',
          'o': 'o',
          'au': 'au',
          'ṃ': 'ṃ',
          'ḥ': 'ḥ',
          'k': 'k',
          'kh': 'kh',
          'g': 'g',
          'gh': 'gh',
          'ṅ': 'ṅ',
          'c': 'c',
          'ch': 'ch',
          'j': 'j',
          'jh': 'jh',
          'ñ': 'ñ',
          'ṭ': 'ṭ',
          'ṭh': 'ṭh',
          'ḍ': 'ḍ',
          'ḍh': 'ḍh',
          'ṇ': 'ṇ',
          't': 't',
          'th': 'th',
          'd': 'd',
          'dh': 'dh',
          'n': 'n',
          'p': 'p',
          'ph': 'ph',
          'b': 'b',
          'bh': 'bh',
          'm': 'm',
          'y': 'y',
          'r': 'r',
          'l': 'l',
          'v': 'v',
          'ś': 'ś',
          'ṣ': 'ṣ',
          's': 's',
          'h': 'h',
          '^a': '^a',
          '^ā': '^ā',
          '^i': '^i',
          '^ī': '^ī',
          '^u': '^u',
          '^ū': '^ū',
          '^ṛ': '^ṛ',
          '^ṝ': '^ṝ',
          '^ḷ': '^ḷ',
          '^ḹ': '^ḹ',
          '^e': '^e',
          '^ai': '^ai',
          '^o': '^o',
          '^au': '^au',
          '_': '_',
          "'": "'",
          "''": "''",
          '/': '/',
          '//': '//'
        }
      , 'kami': {
          'a': 'a',
          'ā': 'aa',
          'i': 'i',
          'ī': 'ii',
          'u': 'u',
          'ū': 'uu',
          'ṛ': '.r',
          'ṝ': ':r',
          'ḷ': '.l',
          'ḹ': ':l',
          'e': 'e',
          'ai': 'ai',
          'o': 'o',
          'au': 'au',
          'ṃ': '.m',
          'ḥ': '.h',
          'k': 'k',
          'kh': 'kh',
          'g': 'g',
          'gh': 'gh',
          'ṅ': '.g',
          'c': 'c',
          'ch': 'ch',
          'j': 'j',
          'jh': 'jh',
          'ñ': '.j',
          'ṭ': '.t',
          'ṭh': '.th',
          'ḍ': '.d',
          'ḍh': '.dh',
          'ṇ': '.n',
          't': 't',
          'th': 'th',
          'd': 'd',
          'dh': 'dh',
          'n': 'n',
          'p': 'p',
          'ph': 'ph',
          'b': 'b',
          'bh': 'bh',
          'm': 'm',
          'y': 'y',
          'r': 'r',
          'l': 'l',
          'v': 'v',
          'ś': '.c',
          'ṣ': '.s',
          's': 's',
          'h': 'h',
          '^a': '^a',
          '^ā': '^aa',
          '^i': '^i',
          '^ī': '^ii',
          '^u': '^u',
          '^ū': '^uu',
          '^ṛ': '^.r',
          '^ṝ': ['^:r', '^.r.r'],
          '^ḷ': '^.l',
          '^ḹ': ['^:l', '^.l.l'],
          '^e': '^e',
          '^ai': '^ai',
          '^o': '^o',
          '^au': '^au',
          '_': '_',
          "'": "'",
          "''": "''",
          '/': '/',
          '//': '//'
        }
      , 'kh': {
          'a': 'a',
          'ā': 'A',
          'i': 'i',
          'ī': 'I',
          'u': 'u',
          'ū': 'U',
          'ṛ': 'R',
          'ṝ': ['RR', 'Q'],
          'ḷ': 'L',
          'ḹ': 'LL',
          'e': 'e',
          'ai': 'ai',
          'o': 'o',
          'au': 'au',
          'ṃ': 'M',
          'ḥ': 'H',
          'k': 'k',
          'kh': 'kh',
          'g': 'g',
          'gh': 'gh',
          'ṅ': 'G',
          'c': 'c',
          'ch': 'ch',
          'j': 'j',
          'jh': 'jh',
          'ñ': 'J',
          'ṭ': 'T',
          'ṭh': 'Th',
          'ḍ': 'D',
          'ḍh': 'Dh',
          'ṇ': 'N',
          't': 't',
          'th': 'th',
          'd': 'd',
          'dh': 'dh',
          'n': 'n',
          'p': 'p',
          'ph': 'ph',
          'b': 'b',
          'bh': 'bh',
          'm': 'm',
          'y': 'y',
          'r': 'r',
          'l': 'l',
          'v': 'v',
          'ś': ['z', 'Z'],
          'ṣ': 'S',
          's': 's',
          'h': 'h',
          '^a': '^a',
          '^ā': '^A',
          '^i': '^i',
          '^ī': '^I',
          '^u': '^u',
          '^ū': '^U',
          '^ṛ': '^R',
          '^ṝ': ['^RR', '^Q'],
          '^ḷ': '^L',
          '^ḹ': '^LL',
          '^e': '^e',
          '^ai': '^ai',
          '^o': '^o',
          '^au': '^au',
          '_': '_',
          "'": "'",
          "''": "''",
          '/': '/',
          '//': '//'
        }
      , '_sorter': {
          'a': '\u0901',
          'ā': '\u0903',
          'i': '\u0905',
          'ī': '\u0907',
          'u': '\u0909',
          'ū': '\u090B',
          'ṛ': '\u090D',
          'ṝ': '\u090F',
          'ḷ': '\u0911',
          'ḹ': '\u0913',
          'e': '\u0915',
          'ai': '\u0917',
          'o': '\u0919',
          'au': '\u091B',
          'ṃ':  '\u091D',
          'ḥ': '\u091E',
          'k': '\u0920',
          'kh': '\u0921',
          'g': '\u0922',
          'gh': '\u0923',
          'ṅ': '\u0924',
          'c': '\u0925',
          'ch': '\u0926',
          'j': '\u0927',
          'jh': '\u0928',
          'ñ': '\u0929',
          'ṭ': '\u092A',
          'ṭh': '\u092B',
          'ḍ': '\u092C',
          'ḍh': '\u092D',
          'ṇ': '\u092E',
          't': '\u092F',
          'th': '\u0930',
          'd': '\u0931',
          'dh': '\u0932',
          'n': '\u0933',
          'p': '\u0934',
          'ph': '\u0935',
          'b': '\u0936',
          'bh': '\u0937',
          'm': '\u0938',
          'y': '\u0939',
          'r': '\u093A',
          'l': '\u093B',
          'v': '\u093C',
          'ś': '\u093D',
          'ṣ': '\u093E',
          's': '\u093F',
          'h': '\u0940',
          '^a': '\u0902',
          '^ā': '\u0904',
          '^i': '\u0906',
          '^ī': '\u0908',
          '^u': '\u090A',
          '^ū': '\u090C',
          '^ṛ': '\u090E',
          '^ṝ': '\u0910',
          '^ḷ': '\u0912',
          '^ḹ': '\u0914',
          '^e': '\u0916',
          '^ai': '\u0918',
          '^o': '\u091A',
          '^au': '\u091C',
          '_': '\u0900'
        }
      }

  function converter(from, to, option) {
    if (!encs[from] || !encs[to]) {
      throw new Error('EncodingLangSa: supported encodings are: '
        + Object.keys(encs).join(', '))
    }
    if (!funcs[from + '-' + to]) {
      funcs[from + '-' + to] = MT.addToNode(from, to, encs[from], encs[to])
    }
    return function(src) {
      var res = src
      if (from === 'deva') {
        res = res.replace(/([\u0915-\u0939])/g, '$1\u094D\u0900')
        .replace(/\u0900([\u094D\u093E-\u094C\u0962\u0963])/g, '$1')
      }
      res = funcs[from + '-' + to](res)
      if (from === 'deva') {
        res = res.replace(/_/g, '')
      }
      if (to === 'deva') {
        if (option && option.removeSpace) {
          res = res.replace(/\u094D /g, '\u094D')
        }
        res = res
        .replace(/\u094D\u0900/g, '')
        .replace(/\u094D([\u093E-\u094C\u0962\u0963])/g, '$1')
        .replace(/\u0900/g, '')
      }
      return res
    }
  }

  function sorter(from, option) {
    var conv = converter(from, '_sorter', option)
    return function(a, b) {
      a = conv(a)
      b = conv(b)
      return a < b ? -1 : a > b ? 1 : 0
    }
  }

  // export
  return {
    converter: converter
  , sorter: sorter
  }
})()
